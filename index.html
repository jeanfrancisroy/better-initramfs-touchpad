<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.7: http://docutils.sourceforge.net/" />
<title>better-initramfs</title>
<link rel="stylesheet" href="style.css" type="text/css" />
</head>
<body>
<div class="document" id="better-initramfs">
<h1 class="title">better-initramfs</h1>

<!-- FIXME: Make website better, add style for <h2>. -->
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#what-can-it-be-useful-for" id="id1">What can it be useful for?</a></li>
<li><a class="reference internal" href="#features" id="id2">Features</a></li>
<li><a class="reference internal" href="#download" id="id3">Download</a></li>
<li><a class="reference internal" href="#usage" id="id4">Usage</a></li>
<li><a class="reference internal" href="#example" id="id5">Example</a></li>
<li><a class="reference internal" href="#license" id="id6">License</a></li>
<li><a class="reference internal" href="#author" id="id7">Author</a></li>
</ul>
</div>
<div class="section" id="what-can-it-be-useful-for">
<h1><a class="toc-backref" href="#id1">What can it be useful for?</a></h1>
<ul class="simple">
<li>Debug your brand-new kernel. For example, you got kernel panic unable to mount rootfs and you really don't know where the problem is, missing filesystems support in kernel or maybe missing support for your SCSI/SATA/whatever or your 2nd sata controller driver started before 1st and your 'sda' is 'sdb'. Really, initramfs sh is very useful. You can check dmesg, you can check /dev for devices and try manual mount rootfs to get error.</li>
<li>Luks encrypted rootfs.</li>
<li>LVM-based rootfs,</li>
<li>System rescue tool.</li>
</ul>
</div>
<div class="section" id="features">
<h1><a class="toc-backref" href="#id2">Features</a></h1>
<ul class="simple">
<li>Support for LVM.</li>
<li>Support for dmcrypt Luks.</li>
<li>Support for booting from rootfs over encrypted lvm (encrypted lv or encrypted pv).</li>
<li>Support for TuxOnIce</li>
<li>Support for <strong>UUID</strong> and <strong>LABEL</strong> based root and enc_root.</li>
<li>RescueShell</li>
</ul>
</div>
<div class="section" id="download">
<h1><a class="toc-backref" href="#id3">Download</a></h1>
<div class="important">
<p class="first admonition-title">Important</p>
<p class="last">Be aware! Current code is under heavy development, make sure to read <strong>ChangeLog</strong> before start with better-initramfs.</p>
</div>
<p>Clone git repository from github:</p>
<pre class="literal-block">
git clone https://github.com/slashbeast/better-initramfs.git
</pre>
</div>
<div class="section" id="usage">
<h1><a class="toc-backref" href="#id4">Usage</a></h1>
<p>This docs is based on Funtoo/Gentoo GNU/Linux so package names etc. can be different than in your distro.</p>
<p>Prepare static linked binary files (emerge with USE=static):</p>
<pre class="literal-block">
sys-apps/busybox (must-have)
sys-fs/cryptsetup (optional, if you don't use dmcrypt)
sys-fs/lvm2 (optional, if you don't use LVM)
</pre>
<p>Build initramfs:</p>
<pre class="literal-block">
make
</pre>
<p>If you does not have Funtoo/Gentoo-based system, you may need install binary files manualy, go to initramfs_root/bin dir and:</p>
<pre class="literal-block">
cp -v /bin/busybox busybox
cp -v /sbin/cryptsetup cryptsetup
cp -v /sbin/lvm.static lvm
ln -s busybox sh
</pre>
<p>Then build image with:</p>
<pre class="literal-block">
make image
</pre>
<p>Available kernel boot parameters:</p>
<dl class="docutils">
<dt>rescueshell</dt>
<dd>drop to busybox's sh just before mount rootfs to /newroot.</dd>
<dt>tuxonice</dt>
<dd>try resume using TuxOnIce. Remember to set resume= variable by <strong>kernel</strong> boot params.</dd>
<dt>resume=&lt;device/path&gt;</dt>
<dd>Use only with <em>tuxonice</em> switch, set resume device/file. This have nothing to do with initramfs..</dd>
<dt>lvm</dt>
<dd>Scan all disks for volume groups and active them.</dd>
<dt>luks</dt>
<dd>do <tt class="docutils literal">cryptsetup luksOpen</tt> on enc_root variable.</dd>
<dt>enc_root=&lt;device&gt;</dt>
<dd>for example <tt class="docutils literal">/dev/sda2</tt> if sda2 is your encrypted rootfs. This variable is ignored if luks isn't enabled.</dd>
<dt>root=&lt;device&gt;</dt>
<dd>for example <tt class="docutils literal">/dev/mapper/enc_root</tt> if you have LUKS-encrypted rootfs, <tt class="docutils literal"><span class="pre">/dev/mapper/vg-rootfs</span></tt> or similar if lvm or just <tt class="docutils literal">/dev/sdXX</tt> if you does not have rootfs over lvm or encrypted.</dd>
<dt>rootfstype=&lt;filesystem type&gt;</dt>
<dd>Set type of filesystem on your rootfs if you do not want to use 'auto',</dd>
<dt>rootdelay=&lt;integer&gt;</dt>
<dd>Set how many secunds initramfs should wait [for devices]. Useful for rootfs on USB device.</dd>
</dl>
</div>
<div class="section" id="example">
<h1><a class="toc-backref" href="#id5">Example</a></h1>
<p>Few example on grub(1) config, all switches and variables are configured by kernel boot command line.</p>
<p>Dmcrypted rootfs:</p>
<pre class="literal-block">
title Funtoo bzImage-2.6.32-gentoo-r5
kernel /bzImage-2.6.32-gentoo-r5 root=/dev/mapper/enc_root enc_root=/dev/sda2 luks
initrd /initramfs.cpio.gz
</pre>
<p>LVM based rootfs:</p>
<pre class="literal-block">
title Funtoo bzImage-2.6.32-gentoo-r5
kernel /bzImage-2.6.32-gentoo-r5 root=/dev/mapper/main-rootfs lvm
initrd /initramfs.cpio.gz
</pre>
<p>LVM based rootfs, rescueshell:</p>
<pre class="literal-block">
title Funtoo bzImage-2.6.32-gentoo-r5
kernel /bzImage-2.6.32-gentoo-r5 root=/dev/mapper/main-rootfs lvm rescueshell
initrd /initramfs.cpio.gz
</pre>
<p>Rootfs on LVM over dmcrypt (encrypted pv) with tuxonice and rootfstype env:</p>
<pre class="literal-block">
title Funtoo bzImage-2.6.33
kernel /bzImage-2.6.33 luks enc_root=/dev/sda2 lvm root=/dev/mapper/vg-rootfs rootfstype=ext4 resume=swap:/dev/mapper/vg-swap tuxonice
initrd /initramfs.cpio.gz
</pre>
</div>
<div class="section" id="license">
<h1><a class="toc-backref" href="#id6">License</a></h1>
<p>This code is under Simplified BSD License, see LICENSE for more information.</p>
</div>
<div class="section" id="author">
<h1><a class="toc-backref" href="#id7">Author</a></h1>
<dl class="docutils">
<dt>better-initramfs is written and maintained by:</dt>
<dd>Piotr Karbowski &lt;<a class="reference external" href="mailto:jabberuser&#64;gmail.com">jabberuser&#64;gmail.com</a>&gt;</dd>
<dt>Thanks to:</dt>
<dd>Yamashita Takao for testing and code suggestions.</dd>
</dl>
</div>
</div>
</body>
</html>
